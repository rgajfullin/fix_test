# Бот для Telegram
  Мониторинговый Telegram-бот для проверки web-сервиса на наличие подстроки в теле ответа на GET-запрос. Бот сообщает об отклонениях в ответе в заданный телеграм канал. 

## Установка

### Зависимости
```
python-2.7.5 или новее
python-requests 
```

### Запуск
  Скопировать содержимое каталога в рабочий каталог, поменять настройки в файле config.json, запустить бота:

```
python bot.py
```

### Описание конфигурационного файла

```
{  
   "telegram":{  
      "token":"", токен для бота
      "chat_id":  ID чата, куда будут отсылаться сообщения
   },
   "service":{  
      "url":"",   URL опрашиваемого сервиса
      "search_string":"" Искомая строка
   },
   "timeout":{  
      "read":1,   Таймаут ожидания ответа от опрашиваемого сервиса, после инициализации поключения 
      "connection":1 Таймаут подключения к опрашиваемому сервису
   }
}
```

#### Ansible роль
  В каталоге roles ansible роль для разворачивания бота на Centos7. Роль клонирует в домашний каталог указанного пользователя последнюю версию бота из ветки master, создает виртуальное окружение, устанавливает зависимости из файла requirements.txt, создает systemd скрипт и запускает бота от имени указанного пользователя. 
Входные параметры для роли
```
      user:               Пользователь и группа, от которого будет запущен сервис, создаются новые, если не существовали ранее. 
        name: telegram 
        group: telegram 
        home: /opt/telegram Домашний каталог пользователя, создается новый, если не существовал ранее.
        shell: /bin/bash    Shell для пользователя.
      telegram:             Токен для бота и ID чата.
        token:              
        chat_id:
      service:              
        url:                URL опрашиваемого сервиса
        search_string:      Искомая строка
```

## Тесты

  В файле bot_test.py unit-тесты для бота, проверяют реакцию бота на исключения, когда сервис не ответил в отведенное время.

### Зависимости
```
python-unittest2
```
### Запуск
```
python -m unittest bot_test
```
  


